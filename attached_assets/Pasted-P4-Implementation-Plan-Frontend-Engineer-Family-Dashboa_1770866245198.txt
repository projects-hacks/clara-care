P4 Implementation Plan -- Frontend Engineer (Family Dashboard)

Current State





**dashboard/ directory does not exist** -- needs to be created from scratch



**voice-web/ directory does not exist** -- no browser voice interface yet



**k8s/ directory does not exist** -- P5 responsibility, not P4



Backend is fully functional with 19 API endpoints across 6 route modules



Sanity CMS has 29 documents seeded (2 patients, 12 conversations, 5 alerts, 7 digests, 2 family members, 1 baseline)



109 backend tests passing



Backend API Endpoints (Dashboard Must Consume)

Patient:





GET /api/patients/{patient_id} -- returns patient profile with baseline, latest digest, recent conversations



PATCH /api/patients/{patient_id} -- update patient profile

Conversations:





GET /api/conversations?patient_id={id}&limit=10&offset=0 -- paginated conversation list



GET /api/conversations/{conversation_id} -- single conversation detail

Wellness:





GET /api/wellness-digests?patient_id={id}&limit=10&offset=0 -- digest list



GET /api/wellness-digests/latest?patient_id={id} -- latest digest



GET /api/cognitive-trends?patient_id={id}&days=30 -- time-series cognitive metrics for charts

Alerts:





GET /api/alerts?patient_id={id}&severity=&limit=20&offset=0 -- alert list (filterable)



PATCH /api/alerts/{alert_id} -- acknowledge alert (body: {acknowledged_by: "..."})

Insights (P3 Showcase):





GET /api/patients/{patient_id}/insights -- cross-document insights (cognitive by mood, nostalgia effectiveness, alert summary)

Reports (P3):





GET /api/reports/{patient_id}/cognitive-report?days=30 -- PDF download



Tech Stack





Framework: Next.js 14+ (App Router)



Language: TypeScript



Styling: Tailwind CSS



Charts: Recharts (better React integration than Chart.js, composable, responsive by default)



Date Formatting: date-fns



HTTP Client: Native fetch with a typed wrapper in lib/api.ts



Icons: lucide-react



Deployment: Replit Mobile Apps



Task 0: Replit + ngrok Setup (Do This FIRST)

Development Workflow

flowchart TD
    ReplitIDE["Replit IDE\n(primary dev environment)"]
    ReplitServer["Replit Dev Server\n(Next.js on :3000)"]
    GitHub["GitHub\n(clara-care repo)"]
    ngrok["ngrok tunnel\n(public URL)"]
    LocalBackend["Local Machine\n(FastAPI on :8000)"]
    Mobile["Replit Mobile App\n(final deployment)"]
    Cursor["Cursor IDE\n(optional local dev)"]

    ReplitIDE -->|"writes code"| ReplitServer
    ReplitIDE <-->|"commit/push/pull"| GitHub
    GitHub <-->|"git pull/push"| Cursor
    ReplitServer -->|"NEXT_PUBLIC_API_URL"| ngrok
    ngrok -->|"tunnels to :8000"| LocalBackend
    ReplitServer -->|"Publish"| Mobile

0a. Start Local Backend + ngrok

On your local machine (2 terminals):

# Terminal 1: Start FastAPI backend
cd /Users/maverickrajeev/Documents/projects/clara-care/backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# Terminal 2: Start ngrok tunnel
ngrok http 8000

ngrok gives you a public URL like https://abc123.ngrok-free.app. Copy this -- it is your NEXT_PUBLIC_API_URL for Replit.

Note: Free ngrok URLs change on restart. Update Replit Secrets each time. For a stable URL, use ngrok paid tier or a fixed domain.

0b. Create Replit Project





Sign in to Replit (use promo code REPLITDEVWEEK for free Replit Core month)



Click "Create Repl" > "Import from GitHub"



Connect to github.com/YOUR_USERNAME/clara-care repo



Replit clones the entire monorepo

0c. Configure Replit for Monorepo

Since our repo is a monorepo (backend/, dashboard/, studio-claracare/), Replit needs to know to run from the dashboard/ subdirectory.

**File: .replit** (in repo root -- create via Replit's file tree)

run = "cd dashboard && npm install && npm run dev"
entrypoint = "dashboard/src/app/page.tsx"

[nix]
channel = "stable-24_05"

[deployment]
run = ["sh", "-c", "cd dashboard && npm run build && npm start"]
deploymentTarget = "cloudrun"

[[ports]]
localPort = 3000
externalPort = 80

**File: replit.nix** (in repo root)

{ pkgs }: {
  deps = [
    pkgs.nodejs_20
    pkgs.nodePackages.npm
  ];
}

0d. Set Replit Secrets

In Replit's "Secrets" tab (padlock icon in left sidebar):





NEXT_PUBLIC_API_URL = your ngrok URL (e.g., https://abc123.ngrok-free.app)



NEXT_PUBLIC_PATIENT_ID = patient-dorothy-001

Do NOT put these in the .replit [env] section -- use the Secrets tab so they are not committed to GitHub.

0e. Verify End-to-End





Backend running locally + ngrok tunnel active on your machine



Hit "Run" on Replit -- installs deps, starts Next.js dev server



Replit shows the dashboard in its built-in browser preview



Test: the dashboard should successfully call {ngrok_url}/api/patients/patient-dorothy-001

0f. GitHub Sync Workflow





Replit to GitHub: Use Replit's Version Control tab (Git icon) to commit and push



GitHub to Replit: Click "Pull" in the Version Control tab



Cursor to GitHub: Standard git push from local machine (optional)



All stay in sync through GitHub as the central hub



Task 1: Project Scaffolding (On Replit)

1a. Create Next.js App

In Replit's Shell tab, run:

npx create-next-app@latest dashboard \
  --typescript --tailwind --eslint --app \
  --src-dir --import-alias "@/*" --no-turbopack

1b. Install Dependencies

cd dashboard
npm install recharts date-fns lucide-react clsx

No @sanity/client needed -- all data fetched via backend API (backend handles Sanity).

1c. Environment Setup

Create dashboard/.env.local.example (committed to repo, for reference):

NEXT_PUBLIC_API_URL=https://your-ngrok-url.ngrok-free.app
NEXT_PUBLIC_PATIENT_ID=patient-dorothy-001

On Replit, actual values come from Replit Secrets (set in Task 0d). For optional local development in Cursor, create dashboard/.env.local with http://localhost:8000.

1d. Verify Dev Server on Replit

Hit "Run" on Replit (or in Shell: cd dashboard && npm run dev). Replit's built-in browser preview should show the Next.js starter page on port 3000.

1e. Tailwind Config

Extend tailwind.config.ts with ClaraCare brand colors:

// Extend with:
colors: {
  clara: {
    50: '#f0f7ff',
    100: '#e0effe',
    500: '#3b82f6',
    600: '#2563eb',
    700: '#1d4ed8',
  },
  mood: {
    happy: '#22c55e',
    neutral: '#64748b',
    sad: '#3b82f6',
    confused: '#eab308',
    distressed: '#ef4444',
    nostalgic: '#a855f7',
  },
  severity: {
    low: '#3b82f6',
    medium: '#eab308',
    high: '#ef4444',
  }
}



Task 2: API Client Layer

File: dashboard/src/lib/api.ts

Typed wrapper around all backend endpoints. Critical design decisions:





Use native fetch (no axios dependency)



Return typed interfaces matching backend response shapes



Handle errors gracefully (return null or empty arrays, never throw in UI)



All functions are async and server-component friendly

const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

// Types matching backend response shapes exactly:
export interface Patient {
  id: string;
  name: string;
  preferred_name: string;
  date_of_birth: string;
  birth_year: number;
  // ... all fields from InMemoryDataStore
}

export interface Conversation {
  id: string;
  patient_id: string;
  timestamp: string;
  duration: number;
  transcript: string;
  summary: string;
  detected_mood: string;
  cognitive_metrics: CognitiveMetrics | null;
}

export interface CognitiveMetrics {
  vocabulary_diversity: number;
  topic_coherence: number;
  repetition_count: number;
  repetition_rate: number;
  word_finding_pauses: number;
  response_latency: number | null;
}

export interface Alert {
  id: string;
  patient_id: string;
  alert_type: string;
  severity: 'low' | 'medium' | 'high';
  description: string;
  acknowledged: boolean;
  timestamp: string;
}

export interface WellnessDigest {
  id: string;
  patient_id: string;
  date: string;
  overall_mood: string;
  cognitive_score: number;
  cognitive_trend: string;
  highlights: string[];
  recommendations: string[];
}

export interface CognitiveTrend {
  timestamp: string;
  vocabulary_diversity: number;
  topic_coherence: number;
  repetition_rate: number;
  word_finding_pauses: number;
  response_latency: number | null;
}

export interface Insights {
  cognitive_by_mood: Record<string, {avg_vocabulary: number; avg_coherence: number; conversation_count: number}>;
  nostalgia_effectiveness: {
    with_nostalgia: {avg_vocabulary: number; avg_coherence: number};
    without_nostalgia: {avg_vocabulary: number; avg_coherence: number};
    improvement_pct: {vocabulary: number; coherence: number};
  };
  alert_summary: {total: number; by_severity: Record<string, number>; most_common_type: string};
}

// Functions:
export async function getPatient(patientId: string): Promise<Patient | null>
export async function getConversations(patientId: string, limit?: number, offset?: number): Promise<Conversation[]>
export async function getConversation(conversationId: string): Promise<Conversation | null>
export async function getCognitivetrends(patientId: string, days?: number): Promise<CognitiveTrend[]>
export async function getAlerts(patientId: string, severity?: string): Promise<Alert[]>
export async function acknowledgeAlert(alertId: string, acknowledgedBy: string): Promise<boolean>
export async function getWellnessDigests(patientId: string, limit?: number): Promise<WellnessDigest[]>
export async function getLatestDigest(patientId: string): Promise<WellnessDigest | null>
export async function getInsights(patientId: string): Promise<Insights | null>
export async function downloadReport(patientId: string, days?: number): Promise<Blob | null>
export async function updatePatient(patientId: string, updates: Partial<Patient>): Promise<boolean>

File: dashboard/src/lib/utils.ts

Utility functions:





formatDate(iso: string): string -- human-readable dates



formatDuration(seconds: number): string -- "4m 30s"



moodEmoji(mood: string): string -- mood to emoji mapping



moodColor(mood: string): string -- mood to tailwind class



severityColor(severity: string): string -- alert severity to color



cognitiveScoreColor(score: number): string -- green/yellow/red



cn(...classes: string[]): string -- conditional class joining (using clsx)



Task 3: Shared Components

File: dashboard/src/components/Navigation.tsx

Bottom navigation bar (mobile-first) with 6 tabs:





Home (house icon)



History (message-circle icon)



Trends (trending-up icon)



Alerts (bell icon) with unacknowledged count badge



Nostalgia (sparkles icon)



Settings (settings icon)

Uses usePathname() from next/navigation for active state.

File: dashboard/src/components/Layout.tsx

Root layout wrapper:





Top bar with ClaraCare logo + patient name



Content area with padding



Bottom Navigation component



Mobile-safe viewport handling

File: dashboard/src/components/MoodIndicator.tsx

Props: { mood: string; size?: 'sm' | 'md' | 'lg' }





Displays mood emoji + label



Color-coded badge

File: dashboard/src/components/CognitiveScoreBadge.tsx

Props: { score: number }





Circular progress indicator (0-100)



Green (80-100), Yellow (60-79), Red (0-59)

File: dashboard/src/components/AlertBadge.tsx

Props: { severity: 'low' | 'medium' | 'high'; count?: number }





Color-coded pill (blue/yellow/red)

File: dashboard/src/components/ConversationCard.tsx

Props: { conversation: Conversation }





Timestamp + duration



Mood indicator



Summary text (truncated)



Click to expand (link to /history/{id})

File: dashboard/src/components/EmptyState.tsx

Props: { icon: LucideIcon; title: string; description: string }





Displayed when lists are empty

File: dashboard/src/components/LoadingSpinner.tsx

Skeleton/spinner for loading states.



Task 4: Dashboard Pages (6 Pages)

Page 1: Home -- Today's Summary (/)

File: dashboard/src/app/page.tsx

Data Fetched:





getPatient(patientId) -- profile



getLatestDigest(patientId) -- today's digest



getAlerts(patientId) -- unacknowledged count



getInsights(patientId) -- P3 showcase

Layout:

+---------------------------------+
|  Good morning, Sarah            |
|  Here's how Dorothy is doing    |
+---------------------------------+
|  [MoodIndicator]  [CogScore]   |
|  Nostalgic today   85/100       |
+---------------------------------+
|  Today's Highlights             |
|  - Shared fond memory of 1963  |
|  - Slight word-finding pause   |
+---------------------------------+
|  Quick Actions                  |
|  [View Alerts (2)] [Download]  |
+---------------------------------+
|  Nostalgia Insight (P3)         |
|  "Vocabulary is 6.5% higher    |
|   during nostalgia sessions"   |
+---------------------------------+

Key Detail: The "Nostalgia Insight" card uses data from GET /api/patients/{id}/insights to show nostalgia_effectiveness.improvement_pct -- this is the P3 Sanity challenge showcase visible in the dashboard.

Page 2: Conversation History (/history)

File: dashboard/src/app/history/page.tsx

Data: getConversations(patientId, 20)

Layout:





Date filter selector (7d / 30d / All)



List of ConversationCard components



Click card to expand full detail

File: dashboard/src/app/history/[id]/page.tsx





Full transcript display



Cognitive metrics sidebar



Mood indicator



Nostalgia engagement details (if triggered)



"Download Report" button

Page 3: Cognitive Trends (/trends)

File: dashboard/src/app/trends/page.tsx

Data: getCognitivetrends(patientId, days)

Charts (all using Recharts LineChart):





Vocabulary Diversity over time (line + baseline dotted)



Topic Coherence over time



Repetition Rate over time (inverted: lower = better)



Word-Finding Pauses over time

Each chart:





Uses ResponsiveContainer for mobile scaling



Dotted horizontal line for baseline value (from patient profile)



Red dot markers where alerts were triggered



Date range selector: 7 / 30 / 90 days



Tooltip showing exact values on hover

Chart Component: dashboard/src/components/CognitiveChart.tsx

interface CognitiveChartProps {
  data: CognitiveTrend[];
  dataKey: keyof CognitiveTrend;
  label: string;
  baseline?: number;
  color: string;
  invertBetter?: boolean; // true for repetition_rate, word_finding_pauses
}

Uses Recharts components: LineChart, Line, XAxis, YAxis, Tooltip, ReferenceLine (for baseline), ResponsiveContainer.

Page 4: Alerts (/alerts)

File: dashboard/src/app/alerts/page.tsx

Data: getAlerts(patientId)

Layout:





Filter by severity (All / High / Medium / Low)



Timeline list, newest first



Each alert card:





Severity badge (color coded)



Alert type (human-readable: "Word Finding Difficulty", "Repetition Increase", etc.)



Description



Timestamp (relative: "2 hours ago")



Acknowledge button (calls PATCH /api/alerts/{id})



Link to related conversation

Key Behavior: Marking an alert as "reviewed" calls acknowledgeAlert(alertId, "Sarah Chen") and optimistically updates UI.

Page 5: Nostalgia Preferences (/nostalgia)

File: dashboard/src/app/nostalgia/page.tsx

Data: getPatient(patientId) -- preferences field

Layout:





Favorite Topics: editable tag list



Music Preferences: editable list



Topics to Avoid: editable list



"Golden Years" display: calculated from birth_year (e.g., "1966-1976 -- Dorothy's peak memory years")



Nostalgia effectiveness stats from insights endpoint

Save: Calls PATCH /api/patients/{id} with updated preferences.

Page 6: Settings (/settings)

File: dashboard/src/app/settings/page.tsx

Data: getPatient(patientId)

Sections:





Medications: List with add/remove (name, dosage, schedule)



Call Schedule: Preferred call time input



Family Contacts: Display contacts with notification preferences



Download Report: Button that calls GET /api/reports/{id}/cognitive-report and triggers browser download

Save: Calls PATCH /api/patients/{id} with updated fields.



Task 5: Root Layout and Global Styles

File: dashboard/src/app/layout.tsx

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <div className="min-h-screen bg-gray-50 pb-20">
          <TopBar />
          <main className="max-w-lg mx-auto px-4 py-6">
            {children}
          </main>
          <Navigation />
        </div>
      </body>
    </html>
  );
}

File: dashboard/src/app/globals.css





Tailwind imports



Custom scrollbar styling



Safe area padding for mobile notch



Task 6: Mobile Responsiveness and Polish

Mobile-first approach (dashboard is primarily used on phones):





Max width: max-w-lg mx-auto (phone viewport)



Touch targets: minimum 44px



Bottom nav: fixed, safe-area-inset-bottom padding



Charts: ResponsiveContainer with min-height



Cards: full-width with rounded corners



Loading: skeleton placeholders matching content shape



Error states: friendly message + retry button



Empty states: illustration + description

Accessibility:





ARIA labels on interactive elements



Color contrast AA compliant



Keyboard navigable



Focus indicators



Task 7: Testing

Test Strategy

Since the dashboard is a Next.js frontend, the critical thing to test is:





API client functions return correct types



Components render without crashing



Pages handle loading/error/empty states

Files:





dashboard/src/lib/__tests__/api.test.ts -- mock fetch, verify URL construction, type parsing



dashboard/src/lib/__tests__/utils.test.ts -- pure function tests (formatDate, moodEmoji, etc.)

Run with npm test (Jest via Next.js).



Task 8: Environment and Build Verification

All commands run in Replit's Shell tab:





cd dashboard && npm run build -- verify no TypeScript errors



npm run lint -- verify ESLint passes



npm run dev -- verify pages render with backend running (via ngrok)



Test end-to-end: local backend + ngrok on your machine, dashboard on Replit, verify all 6 pages load with real data



Task 9: Replit Mobile Deployment

Since Replit was connected to GitHub in Task 0, deployment is straightforward:





Push all code to GitHub from Cursor (git push)



In Replit: Pull latest from GitHub (or auto-syncs)



Verify Replit runs: Click "Run" -- should build and serve the dashboard



Set Replit Secrets: NEXT_PUBLIC_API_URL must point to the publicly-accessible backend:





Option A: Backend deployed on Akamai LKE (P5's job) -- use that URL



Option B: Backend exposed via ngrok (ngrok http 8000) -- use the ngrok URL



Option C: Backend running on a separate Replit -- use that URL



Test on Replit: Verify all 6 pages load, charts render, alerts work



Publish as Mobile App: In Replit, click "Deploy" then "Publish as Mobile App"



Test on real device: Scan QR code on phone, verify mobile experience



Screenshot for DevPost: Capture phone screenshot showing dashboard on mobile



Share link: Copy the Replit mobile app URL for team

Replit-Specific Considerations





CORS: Backend CORS already allows all origins (allow_origins=["*"]), so Replit's domain will work



API latency: Replit servers are in US, backend must be network-accessible (not localhost)



Build time: Replit free tier may have build time limits; Replit Core (from promo code) removes this



Custom domain: Optional -- Replit provides a .replit.app domain automatically



Lessons Learned from P2/P3 (Apply to P4)





No dead dependencies in package.json -- only install what you import



Type safety -- every API response must be typed, no any



Error handling -- every fetch must have try/catch, never crash on API errors



No hardcoded patient IDs -- use NEXT_PUBLIC_PATIENT_ID env var



Backend response shapes -- read the actual route code to see response structure; don't guess field names



Test with real backend -- run npm run dev against actual backend to verify data flows



File Ownership Summary

# Repo root (Replit config)
.replit                         -- Replit run/deploy configuration
replit.nix                      -- Replit Nix environment (Node.js 20)

# Dashboard directory
dashboard/
  src/
    app/
      layout.tsx              -- root layout
      page.tsx                -- Home page
      globals.css             -- global styles
      history/
        page.tsx              -- conversation list
        [id]/page.tsx         -- conversation detail
      trends/page.tsx         -- cognitive charts
      alerts/page.tsx         -- alert timeline
      nostalgia/page.tsx      -- nostalgia preferences
      settings/page.tsx       -- settings + report download
    components/
      Navigation.tsx          -- bottom nav
      TopBar.tsx              -- top bar with patient name
      MoodIndicator.tsx       -- mood emoji + label
      CognitiveScoreBadge.tsx -- circular score display
      CognitiveChart.tsx      -- reusable Recharts line chart
      ConversationCard.tsx    -- conversation summary card
      AlertCard.tsx           -- alert item with acknowledge
      AlertBadge.tsx          -- severity pill
      EmptyState.tsx          -- empty list placeholder
      LoadingSpinner.tsx      -- skeleton/loading
    lib/
      api.ts                  -- backend API client (typed)
      utils.ts                -- utility functions
      __tests__/
        api.test.ts
        utils.test.ts
  .env.local.example
  package.json
  tailwind.config.ts
  tsconfig.json
  next.config.ts



Implementation Order

gantt
    title P4 Implementation Order
    dateFormat X
    axisFormat %s

    section ReplitSetup
    CreateReplitProject :r0, 0, 1
    ConnectGitHub :r1, after r0, 1
    AddReplitConfig :r2, after r1, 1

    section Scaffolding
    CreateNextApp :s1, after r2, 1
    InstallDeps :s2, after s1, 1
    TailwindConfig :s3, after s2, 1

    section APILayer
    TypeDefinitions :a1, after s3, 1
    APIClient :a2, after a1, 2
    UtilityFunctions :a3, after a1, 1

    section SharedComponents
    NavigationTopBar :c1, after a2, 1
    MoodAlertBadges :c2, after c1, 1
    ConversationCard :c3, after c1, 1
    CognitiveChart :c4, after c1, 2

    section Pages
    HomePage :p1, after c2, 2
    HistoryPage :p2, after c3, 2
    TrendsPage :p3, after c4, 2
    AlertsPage :p4, after c2, 2
    NostalgiaPage :p5, after p1, 1
    SettingsPage :p6, after p1, 1

    section Polish
    Responsive :pol1, after p4, 1
    LoadingErrorStates :pol2, after pol1, 1
    Accessibility :pol3, after pol2, 1

    section TestAndDeploy
    Tests :t1, after pol3, 1
    BuildVerify :t2, after t1, 1
    ReplitPublish :t3, after t2, 1





Replit + ngrok setup: Create Replit project from GitHub, start ngrok for local backend, configure .replit + replit.nix



Scaffold on Replit: create-next-app + Tailwind + deps in dashboard/



API client + types + utils (data layer -- test against ngrok-exposed backend)



Shared components: Navigation, MoodIndicator, CognitiveChart, etc.



Pages: Home, History, Trends, Alerts (in parallel)



Remaining pages: Nostalgia + Settings (simpler)



Polish: responsive, loading states, error handling



Test + build verify: npm run build, npm run lint, test all pages on Replit



Publish as Replit Mobile App -- one click deploy, test on real device via QR



Critical Validation Checklist

Before marking P4 complete:





All 6 pages render correctly with real backend data



npm run build succeeds with zero TypeScript errors



npm run lint passes



Charts display cognitive trends with baseline overlay



Alerts can be acknowledged (PATCH calls work)



PDF report downloads via browser



Mobile responsive (test at 375px width)



Loading states shown while data fetches



Error states shown when backend is unreachable



Empty states shown when no conversations/alerts exist



Bottom navigation highlights active page



Patient name displays in top bar



Insights card on home page shows nostalgia effectiveness



No any types in TypeScript



No hardcoded patient IDs



.env.local.example committed (not .env.local)

